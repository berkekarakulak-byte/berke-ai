<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Berke AI</title>

<style>
:root{
  --bg:#0f172a;
  --panel:#020617;
  --border:#1e293b;
  --user:#2563eb;
  --ai:#1e293b;
  --text:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui,Arial;
}
.app{
  max-width:900px;
  height:100vh;
  margin:auto;
  display:flex;
  flex-direction:column;
}
.header{
  padding:14px 20px;
  border-bottom:1px solid var(--border);
  font-weight:600;
  background:var(--panel);
}
.login{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:14px;
}
button{
  padding:14px 22px;
  border-radius:14px;
  border:none;
  font-size:15px;
  cursor:pointer;
}
.google{
  background:#fff;
  color:#000;
}
.guest{
  background:#1e293b;
  color:#fff;
}
.chat{
  flex:1;
  display:none;
  flex-direction:column;
}
.messages{
  flex:1;
  padding:20px;
  overflow-y:auto;
}
.msg{
  max-width:72%;
  padding:12px 14px;
  border-radius:16px;
  margin-bottom:12px;
  line-height:1.5;
  white-space:pre-wrap;
}
.user{
  background:var(--user);
  margin-left:auto;
  border-bottom-right-radius:4px;
}
.ai{
  background:var(--ai);
  border-bottom-left-radius:4px;
}
.input{
  border-top:1px solid var(--border);
  padding:14px;
  background:var(--panel);
}
textarea{
  width:100%;
  resize:none;
  padding:14px;
  border-radius:14px;
  border:none;
  outline:none;
  background:#020617;
  color:var(--text);
  font-size:15px;
}
</style>
</head>

<body>

<div class="app">
  <div class="header">âœ¨ Berke AI</div>

  <!-- LOGIN -->
  <div class="login" id="login">
    <button class="google" onclick="location.href='/auth/google'">
      Google ile devam et
    </button>
    <button class="guest" onclick="guest()">
      Misafir olarak devam et
    </button>
  </div>

  <!-- CHAT -->
  <div class="chat" id="chat">
    <div class="messages" id="msgs"></div>
    <div class="input">
      <textarea id="m" rows="2"
        placeholder="Mesaj yazâ€¦ (Enter gÃ¶nder, Shift+Enter satÄ±r)"
        onkeydown="handleKey(event)">
      </textarea>
    </div>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search)
const email = params.get("email")
const loginType = params.get("login")

// ðŸ”¥ GOOGLE LOGIN â†’ DÄ°REKT CHAT
if(loginType==="google" && email){
  login.style.display="none"
  chat.style.display="flex"
}

function guest(){
  fetch("/guest",{method:"POST"})
  login.style.display="none"
  chat.style.display="flex"
}

function handleKey(e){
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault()
    send()
  }
}

async function send(){
  if(!m.value.trim()) return
  const text = m.value
  m.value=""

  msgs.innerHTML += `<div class="msg user">${text}</div>`
  msgs.scrollTop = msgs.scrollHeight

  const r = await fetch("/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:text,email:email})
  })
  const j = await r.json()

  msgs.innerHTML += `<div class="msg ai">${j.reply}</div>`
  msgs.scrollTop = msgs.scrollHeight
}
</script>

</body>
</html>
