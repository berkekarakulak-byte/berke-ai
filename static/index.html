<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#020617">
<title>Berke AI</title>

<style>
:root{
  --txt:#e5e7eb;
  --mut:#94a3b8;
  --stroke: 1px solid rgba(148,163,184,.20);
  --shadow: 0 25px 80px rgba(0,0,0,.55);

  --glassA: rgba(2,6,23,.52);
  --glassB: rgba(15,23,42,.38);

  --user1:#2563eb;
  --user2:#1d4ed8;
  --aiBg: rgba(30,41,59,.78);

  --panel: rgba(2,6,23,.55);
  --panel2: rgba(2,6,23,.35);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--txt);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Arial;
  overflow:hidden;
  background: url("/static/bg.jpg") center/cover no-repeat fixed;
}
body::before{
  content:"";
  position:fixed; inset:0;
  background: rgba(2,6,23,.62);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  z-index:-1;
}

/* Outer shell */
.shell{
  height:100dvh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
  padding-top: calc(16px + env(safe-area-inset-top));
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
}

/* App card */
.app{
  width:min(980px, 100%);
  height:min(820px, 100dvh);
  border-radius:22px;
  border: var(--stroke);
  box-shadow: var(--shadow);
  background: linear-gradient(180deg, var(--glassA), var(--glassB));
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* Mobile: take full height */
@media (max-width: 640px){
  .shell{ padding:0; }
  .app{
    width:100%;
    height:100dvh;
    border-radius:0;
    border:none;
    box-shadow:none;
  }
}

/* Header */
.header{
  flex:0 0 auto;
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom: 1px solid rgba(148,163,184,.18);
  background: var(--panel2);
}
.brand{
  display:flex; flex-direction:column; gap:2px;
}
.brand .title{
  font-weight:900;
  letter-spacing:.4px;
  display:flex;
  gap:10px;
  align-items:center;
}
.badge{
  font-size:11px;
  color:var(--mut);
  border:1px solid rgba(148,163,184,.22);
  padding:4px 10px;
  border-radius:999px;
  background: rgba(2,6,23,.22);
}
.brand .sub{ font-size:12px; color:var(--mut); }

.actions{ display:flex; gap:10px; align-items:center; }
.pill{
  border:1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.22);
  color: var(--txt);
  padding:8px 12px;
  border-radius:999px;
  cursor:pointer;
  font-size:12px;
  user-select:none;
}
.pill:hover{ background: rgba(2,6,23,.34); }

/* Login */
.login{
  flex:1 1 auto;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:22px;
}
.login-card{
  width:min(560px, 92vw);
  border-radius:22px;
  border: var(--stroke);
  background: rgba(2,6,23,.38);
  box-shadow: 0 18px 60px rgba(0,0,0,.45);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  padding:18px;
}
.login-title{
  font-size:18px;
  font-weight:900;
  margin: 6px 0 10px;
}
.login-desc{
  font-size:13px;
  color:var(--mut);
  line-height:1.55;
  margin-bottom:14px;
}
.btn{
  width:100%;
  padding:14px 14px;
  border-radius:16px;
  border: 1px solid rgba(148,163,184,.20);
  background: rgba(2,6,23,.30);
  color: var(--txt);
  cursor:pointer;
  font-size:15px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
.btn:hover{ background: rgba(2,6,23,.42); }
.btn-google{
  background: rgba(255,255,255,.96);
  color:#0b1220;
  border:none;
  font-weight:900;
}
.btn-google:hover{ background:#fff; }
.sep{ height:10px; }
.small{ font-size:12px; color:var(--mut); text-align:center; margin-top:12px; }

/* Chat layout */
.chat{
  flex:1 1 auto;
  display:none;
  min-height:0;
  position:relative;
}

/* Message area */
.messages{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  -webkit-overflow-scrolling: touch;
  padding:16px;
  padding-bottom:140px; /* input space */
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* Row align */
.row{
  display:flex;
  width:100%;
}
.row.user{ justify-content:flex-end; }
.row.ai{ justify-content:flex-start; }

/* Bubble (WhatsApp vibe) */
.bubble{
  max-width: 78%;
  position:relative;
  padding:12px 14px;
  border-radius:18px;
  line-height:1.55;
  border:1px solid rgba(148,163,184,.14);
  box-shadow: 0 12px 35px rgba(0,0,0,.35);
  white-space:pre-wrap;
  word-wrap:break-word;
}
@media (min-width: 768px){
  .bubble{ max-width: 64%; }
}
.user .bubble{
  background: linear-gradient(135deg, var(--user1), var(--user2));
  border-bottom-right-radius:8px;
}
.ai .bubble{
  background: var(--aiBg);
  border-bottom-left-radius:8px;
}

/* bubble tail */
.user .bubble::after{
  content:"";
  position:absolute;
  right:-6px;
  bottom:10px;
  width:12px;
  height:12px;
  background: linear-gradient(135deg, var(--user1), var(--user2));
  transform: rotate(45deg);
  border-radius:3px;
}
.ai .bubble::after{
  content:"";
  position:absolute;
  left:-6px;
  bottom:10px;
  width:12px;
  height:12px;
  background: var(--aiBg);
  transform: rotate(45deg);
  border-radius:3px;
}

/* Time under bubble */
.time{
  margin-top:6px;
  font-size:11px;
  color: rgba(229,231,235,.70);
}
.row.user .time{ text-align:right; }

/* typing */
.typing{
  font-size:13px;
  color:var(--mut);
  margin: 6px 0 0 2px;
}

/* Input bar pinned */
.inputbar{
  position:sticky;
  bottom:0;
  padding:12px;
  padding-bottom: calc(12px + env(safe-area-inset-bottom));
  border-top: 1px solid rgba(148,163,184,.18);
  background: var(--panel);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
}

.composer{
  display:flex;
  gap:10px;
  align-items:flex-end;
}
textarea{
  flex:1 1 auto;
  resize:none;
  min-height:46px;
  max-height:170px;
  padding:12px 14px;
  border-radius:16px;
  border: 1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.35);
  color: var(--txt);
  outline:none;
  font-size:16px; /* iOS zoom fix */
}
textarea::placeholder{ color: rgba(148,163,184,.85); }

.send{
  width:46px;
  height:46px;
  border-radius:16px;
  border: 1px solid rgba(148,163,184,.22);
  background: rgba(2,6,23,.35);
  color: var(--txt);
  cursor:pointer;
}
.send:hover{ background: rgba(2,6,23,.48); }
</style>
</head>

<body>
<div class="shell">
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="title">âœ¨ Berke AI <span class="badge">WP Style</span></div>
        <div class="sub">Glass â€¢ Dark â€¢ PC + Mobile Perfect</div>
      </div>

      <div class="actions">
        <div class="pill" id="adminBtn" style="display:none;">Admin</div>
        <div class="pill" onclick="hardRefreshHint()">Cache</div>
      </div>
    </div>

    <!-- LOGIN -->
    <div class="login" id="login">
      <div class="login-card">
        <div class="login-title">Devam etmek iÃ§in giriÅŸ yap</div>
        <div class="login-desc">
          Google ile giriÅŸ yaparsan hafÄ±zan sana Ã¶zel tutulur. Misafir modunda sohbet Ã§alÄ±ÅŸÄ±r ama sadece misafir sayÄ±mÄ± tutulur.
        </div>

        <button class="btn btn-google" onclick="location.href='/auth/google'">
          <svg width="18" height="18" viewBox="0 0 48 48" aria-hidden="true">
            <path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.6 32.7 29.2 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.2 6.1 29.3 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.2-.1-2.3-.4-3.5z"/>
            <path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.7 16 19 12 24 12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.2 6.1 29.3 4 24 4 16.3 4 9.6 8.4 6.3 14.7z"/>
            <path fill="#4CAF50" d="M24 44c5.1 0 9.8-2 13.3-5.2l-6.1-5.2C29.1 35.4 26.7 36 24 36c-5.2 0-9.6-3.3-11.3-8l-6.6 5.1C9.4 39.6 16.3 44 24 44z"/>
            <path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1.1 3-3.4 5.3-6.3 6.6l6.1 5.2C38.7 36.5 44 31.1 44 24c0-1.2-.1-2.3-.4-3.5z"/>
          </svg>
          Google ile devam et
        </button>

        <div class="sep"></div>

        <button class="btn" onclick="guest()">Misafir olarak devam et</button>

        <div class="small">Edge eski arayÃ¼zÃ¼ cacheâ€™leyebilir. Ctrl+F5 deneyebilirsin.</div>
      </div>
    </div>

    <!-- CHAT -->
    <div class="chat" id="chat">
      <div class="messages" id="msgs"></div>

      <div class="inputbar">
        <form class="composer" onsubmit="send(event)">
          <textarea id="m" rows="1" placeholder="Mesaj yazâ€¦ (Enter gÃ¶nder, Shift+Enter satÄ±r)"></textarea>
          <button class="send" type="submit" title="GÃ¶nder">âž¤</button>
        </form>
        <div class="typing" id="typing" style="display:none;">Berke AI yazÄ±yorâ€¦</div>
      </div>
    </div>
  </div>
</div>

<script>
const msgs = document.getElementById("msgs");
const typing = document.getElementById("typing");
const ta = document.getElementById("m");

const params = new URLSearchParams(location.search);
const email = params.get("email") || "";
const loginType = params.get("login") || "";

function showChat(){
  document.getElementById("login").style.display="none";
  document.getElementById("chat").style.display="flex";

  if(email === "berkekarakulak@gmail.com"){
    const a = document.getElementById("adminBtn");
    a.style.display="inline-block";
    a.onclick = () => location.href = `/admin?email=${encodeURIComponent(email)}`;
  }
  scrollBottom();
}

if(loginType==="google" && email){
  showChat();
}

function guest(){
  fetch("/guest",{method:"POST"}).catch(()=>{});
  history.replaceState(null,"", "/");
  showChat();
}

// Enter send / Shift+Enter newline
ta.addEventListener("keydown", (e)=>{
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();
    ta.form.requestSubmit();
  }
});

// Auto-grow textarea
ta.addEventListener("input", ()=>{
  ta.style.height = "auto";
  ta.style.height = Math.min(170, ta.scrollHeight) + "px";
});

// On focus, keep at bottom (mobile keyboard)
ta.addEventListener("focus", ()=>{
  setTimeout(scrollBottom, 160);
});

function nowTime(){
  return new Date().toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"});
}

function addBubble(role, text){
  const row = document.createElement("div");
  row.className = "row " + role;

  const box = document.createElement("div");
  box.className = "bubble";
  box.textContent = text;

  const time = document.createElement("div");
  time.className = "time";
  time.textContent = nowTime();

  const wrap = document.createElement("div");
  wrap.style.display = "flex";
  wrap.style.flexDirection = "column";
  wrap.appendChild(box);
  wrap.appendChild(time);

  row.appendChild(wrap);
  msgs.appendChild(row);
  scrollBottom();
}

function scrollBottom(){
  msgs.scrollTop = msgs.scrollHeight;
}

function typingOn(){ typing.style.display="block"; scrollBottom(); }
function typingOff(){ typing.style.display="none"; }

async function send(e){
  if(e) e.preventDefault();
  const text = (ta.value || "").trim();
  if(!text) return;

  ta.value = "";
  ta.style.height = "auto";
  addBubble("user", text);
  typingOn();

  try{
    const r = await fetch("/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({message:text, email: email})
    });
    const j = await r.json();
    typingOff();
    addBubble("ai", j.reply || "BoÅŸ cevap geldi ðŸ˜…");
  }catch(err){
    typingOff();
    addBubble("ai", "BaÄŸlantÄ± hatasÄ± oldu. Tekrar dener misin?");
  }
}

function hardRefreshHint(){
  alert("Edge bazen eski UI kalabilir.\nCtrl+F5 yap veya URLâ€™ye ?v=2 ekle.");
}
</script>
</body>
</html>
