<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Berke AI</title>

<style>
:root{
  --bg:#020617;
  --panel:#020617;
  --border:#1e293b;
  --user:#2563eb;
  --ai:#111827;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;height:100vh;
  background:radial-gradient(circle at top,var(--bg),#000);
  font-family:Inter,system-ui,Arial;
  display:flex;justify-content:center;align-items:center;
  color:var(--text);
}

/* ONBOARD */
.onboard{
  position:fixed;inset:0;
  background:rgba(2,6,23,.92);
  backdrop-filter:blur(18px);
  display:flex;align-items:center;justify-content:center;
  z-index:10;
}
.card{
  width:380px;
  background:linear-gradient(180deg,var(--panel),#000);
  border:1px solid var(--border);
  border-radius:22px;
  padding:28px;
  text-align:center;
  box-shadow:0 40px 80px rgba(0,0,0,.9);
}
.card h1{margin:0 0 8px}
.card p{color:var(--muted);font-size:14px;margin-bottom:24px}
.card button{
  width:100%;padding:14px;
  border-radius:14px;border:none;
  cursor:pointer;font-size:14px;
  margin-bottom:12px;
}
.google{background:linear-gradient(135deg,#4285F4,#2563eb);color:white}
.guest{background:#020617;border:1px solid var(--border);color:white}

/* CHAT */
.chat{
  width:420px;height:640px;
  background:linear-gradient(180deg,var(--panel),#000);
  border-radius:22px;
  border:1px solid var(--border);
  display:flex;flex-direction:column;
  overflow:hidden;
}
.header{
  padding:16px;text-align:center;
  font-weight:600;border-bottom:1px solid var(--border);
}
.messages{
  flex:1;padding:16px;
  overflow-y:auto;display:flex;
  flex-direction:column;gap:12px;
}
.wrap{
  max-width:80%;
  display:flex;flex-direction:column;
  gap:4px;
}
.wrap.user{align-self:flex-end;align-items:flex-end}
.wrap.ai{align-self:flex-start}
.bubble{
  padding:12px 16px;
  border-radius:16px;
  font-size:14px;line-height:1.45;
}
.user .bubble{
  background:linear-gradient(135deg,#2563eb,#1d4ed8);
}
.ai .bubble{
  background:linear-gradient(135deg,var(--ai),var(--panel));
  border:1px solid var(--border);
}
.time{font-size:11px;color:var(--muted)}
.typing{font-size:13px;color:var(--muted);animation:pulse 1.2s infinite}
.input{
  display:flex;gap:10px;
  padding:14px;border-top:1px solid var(--border);
}
input{
  flex:1;padding:14px;
  border-radius:14px;border:1px solid var(--border);
  background:var(--panel);color:white;
}
.send{
  background:linear-gradient(135deg,#2563eb,#1d4ed8);
  border:none;color:white;
  padding:0 18px;border-radius:14px;
  cursor:pointer;
}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}
</style>
</head>

<body>

<!-- ONBOARD -->
<div class="onboard" id="onboard">
  <div class="card">
    <h1>‚ú® Berke AI</h1>
    <p>Sana √∂zel yapay zeka deneyimi</p>

    <button class="google" onclick="location.href='/auth/google'">
      Google ile giri≈ü yap
    </button>

    <button class="guest" onclick="closeOnboard()">
      Misafir olarak devam et
    </button>
  </div>
</div>

<!-- CHAT -->
<div class="chat">
  <div class="header">Berke AI</div>
  <div class="messages" id="msgs"></div>
  <div class="input">
    <input id="inp" placeholder="Bir ≈üey yaz‚Ä¶" />
    <button class="send" onclick="send()">G√∂nder</button>
  </div>
</div>

<script>
const msgs=document.getElementById("msgs");
const inp=document.getElementById("inp");
const onboard=document.getElementById("onboard");

// üîä SES
const ctx=new (window.AudioContext||window.webkitAudioContext)();
function clickSound(){
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.connect(g);g.connect(ctx.destination);
  o.frequency.value=520;
  g.gain.setValueAtTime(.03,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.12);
  o.start();o.stop(ctx.currentTime+.12);
}

function closeOnboard(){
  onboard.style.display="none";
}

function add(text,who,time){
  const w=document.createElement("div");
  w.className="wrap "+who;
  const b=document.createElement("div");
  b.className="bubble";b.textContent=text;
  const t=document.createElement("div");
  t.className="time";t.textContent=time;
  w.append(b,t);msgs.append(w);
  msgs.scrollTop=msgs.scrollHeight;
}

let typing=null;
function showTyping(){
  typing=document.createElement("div");
  typing.className="typing";
  typing.textContent="AI yazƒ±yor‚Ä¶";
  msgs.append(typing);
  msgs.scrollTop=msgs.scrollHeight;
}
function hideTyping(){if(typing){typing.remove();typing=null;}}

async function send(){
  const text=inp.value.trim();
  if(!text) return;
  clickSound();
  const now=new Date().toLocaleTimeString([],{
    hour:"2-digit",minute:"2-digit"
  });
  add(text,"user",now);
  inp.value="";
  showTyping();

  const r=await fetch("/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:text})
  });
  const j=await r.json();
  hideTyping();
  add(j.reply,"ai",j.time);
}

inp.addEventListener("keydown",e=>{
  if(e.key==="Enter"){e.preventDefault();send();}
});
</script>

</body>
</html>
