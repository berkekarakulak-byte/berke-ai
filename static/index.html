<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Berke AI</title>

<style>
:root{
  --bg:#020617;
  --panel:#020617;
  --border:#1e293b;
  --user:#2563eb;
  --ai:#111827;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
:root.darker{
  --bg:#000;
  --panel:#020617;
  --border:#111827;
  --user:#1d4ed8;
  --ai:#020617;
  --text:#e5e7eb;
  --muted:#64748b;
}
*{box-sizing:border-box}
body{
  margin:0;height:100vh;
  background:radial-gradient(circle at top,var(--bg),#000);
  font-family:Inter,system-ui,Arial;
  display:flex;justify-content:center;align-items:center;
  color:var(--text);
}
.chat{
  width:420px;height:640px;
  background:linear-gradient(180deg,var(--panel),#000);
  border-radius:18px;
  display:flex;flex-direction:column;
  border:1px solid var(--border);
  box-shadow:0 40px 80px rgba(0,0,0,.9);
  overflow:hidden;position:relative;
}
.header{
  padding:16px;text-align:center;
  font-weight:600;border-bottom:1px solid var(--border);
  position:relative;
}
.header .right{
  position:absolute;right:12px;top:12px;
  display:flex;gap:8px;
}
.header button{
  background:none;border:none;
  color:#93c5fd;font-size:12px;
  cursor:pointer;
}
.messages{
  flex:1;padding:16px;
  overflow-y:auto;display:flex;
  flex-direction:column;gap:12px;
}
.wrap{
  max-width:80%;
  display:flex;flex-direction:column;
  gap:4px;animation:fade .18s ease;
}
.wrap.user{align-self:flex-end;align-items:flex-end}
.wrap.ai{align-self:flex-start}
.bubble{
  padding:12px 16px;border-radius:16px;
  font-size:14px;line-height:1.45;
}
.user .bubble{
  background:linear-gradient(135deg,#2563eb,#1d4ed8);
}
.ai .bubble{
  background:linear-gradient(135deg,var(--ai),var(--panel));
  border:1px solid var(--border);
}
.time{font-size:11px;color:var(--muted)}
.typing{
  font-size:13px;color:var(--muted);
  padding-left:6px;animation:pulse 1.2s infinite;
}
.input{
  display:flex;gap:10px;
  padding:14px;border-top:1px solid var(--border);
}
input{
  flex:1;padding:14px 16px;
  border-radius:14px;border:1px solid var(--border);
  background:var(--panel);color:white;
  outline:none;
}
button.send{
  padding:0 18px;border-radius:14px;
  border:none;background:linear-gradient(135deg,#2563eb,#1d4ed8);
  color:white;cursor:pointer;
}
.profile{
  position:absolute;inset:0;
  background:linear-gradient(180deg,var(--panel),#000);
  padding:20px;display:none;
  flex-direction:column;gap:14px;
}
.profile pre{
  flex:1;background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;padding:14px;
  white-space:pre-wrap;
}
@keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1}}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}
</style>
</head>

<body>

<div class="chat">
  <div class="header">
    ‚ú® Berke AI
    <div class="right">
      <button onclick="location.href='/auth/google'">Google</button>
      <button onclick="toggleTheme()">Tema</button>
      <button onclick="openProfile()">Profil</button>
    </div>
  </div>

  <div class="messages" id="msgs"></div>

  <div class="input">
    <input id="inp" placeholder="Bir ≈üey yaz‚Ä¶" />
    <button class="send" onclick="send()">G√∂nder</button>
  </div>
</div>

<div class="profile" id="profile">
  <h3>AI seni b√∂yle tanƒ±yor</h3>
  <pre id="profileText"></pre>
  <button onclick="closeProfile()">Kapat</button>
</div>

<script>
const msgs=document.getElementById("msgs");
const inp=document.getElementById("inp");
const root=document.documentElement;

// üîä Soft click sound
const ctx=new (window.AudioContext||window.webkitAudioContext)();
function sound(){
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.connect(g);g.connect(ctx.destination);
  o.frequency.value=600;
  g.gain.setValueAtTime(.03,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.12);
  o.start();o.stop(ctx.currentTime+.12);
}

function add(text,who,time){
  const w=document.createElement("div");
  w.className="wrap "+who;
  const b=document.createElement("div");
  b.className="bubble";b.textContent=text;
  const t=document.createElement("div");
  t.className="time";t.textContent=time;
  w.append(b,t);msgs.append(w);
  msgs.scrollTop=msgs.scrollHeight;
}

let typing=null;
function showTyping(){
  typing=document.createElement("div");
  typing.className="typing";
  typing.textContent="AI yazƒ±yor‚Ä¶";
  msgs.append(typing);
  msgs.scrollTop=msgs.scrollHeight;
}
function hideTyping(){if(typing){typing.remove();typing=null;}}

async function send(){
  const text=inp.value.trim();
  if(!text) return;
  sound();
  const now=new Date().toLocaleTimeString([],{
    hour:"2-digit",minute:"2-digit"
  });
  add(text,"user",now);
  inp.value="";
  showTyping();
  const r=await fetch("/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:text})
  });
  const j=await r.json();
  hideTyping();
  add(j.reply,"ai",j.time);
}

inp.addEventListener("keydown",e=>{
  if(e.key==="Enter"){e.preventDefault();send();}
});

function toggleTheme(){root.classList.toggle("darker");}

async function openProfile(){
  profile.style.display="flex";
  const r=await fetch("/profile");
  const j=await r.json();
  profileText.textContent=j.summary||"Hen√ºz bilgi yok.";
}
function closeProfile(){profile.style.display="none";}
</script>

</body>
</html>
