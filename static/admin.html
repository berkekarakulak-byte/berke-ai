<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Admin • Berke AI</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1620;
      --border:rgba(255,255,255,.08);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.6);
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 15% 10%, rgba(59,130,246,.18), transparent 55%),
                  radial-gradient(900px 600px at 85% 20%, rgba(34,197,94,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      min-height:100vh;
      padding:18px;
    }
    .wrap{max-width:1100px;margin:0 auto}
    .top{
      display:flex;align-items:center;justify-content:space-between;
      border:1px solid var(--border);border-radius:var(--radius);
      background:rgba(255,255,255,.03);
      padding:14px 16px;
      box-shadow: var(--shadow);
    }
    h1{margin:0;font-size:16px}
    .sub{margin:4px 0 0 0;color:var(--muted);font-size:12px}
    button{
      border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      font-weight:650;
      cursor:pointer;
    }
    .card{
      margin-top:14px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:rgba(255,255,255,.03);
      padding:14px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    table{width:100%;border-collapse:collapse}
    th,td{
      padding:10px 8px;
      border-bottom:1px solid var(--border);
      text-align:left;
      font-size:12px;
      vertical-align:top;
    }
    th{color:var(--muted);font-weight:800;letter-spacing:.2px}
    .pill{
      display:inline-flex;align-items:center;gap:6px;
      border:1px solid var(--border);
      border-radius:999px;
      padding:4px 8px;
      font-size:11px;
      background:rgba(255,255,255,.04);
      color:var(--muted);
    }
    .muted{color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>Admin Panel</h1>
      <div class="sub">Kim kaç kez girdi + son giriş</div>
    </div>
    <div style="display:flex;gap:10px">
      <button onclick="location.href='/'">Sohbete dön</button>
      <button onclick="load()">Yenile</button>
    </div>
  </div>

  <div class="card">
    <div class="muted" id="summary">Yükleniyor…</div>
    <div style="overflow:auto;margin-top:10px">
      <table>
        <thead>
          <tr>
            <th>Tür</th>
            <th>Email / ID</th>
            <th>Giriş sayısı</th>
            <th>Son giriş</th>
            <th>Meta</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  const tbody = document.getElementById("tbody");
  const summary = document.getElementById("summary");

  function pill(txt){
    return `<span class="pill">${txt}</span>`;
  }

  function esc(s){
    return String(s ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }

  async function load(){
    tbody.innerHTML = "";
    summary.textContent = "Yükleniyor…";
    const r = await fetch("/api/admin/stats");
    const data = await r.json();
    if(!r.ok){
      summary.textContent = "Hata: " + (data.detail || "Yetkisiz");
      return;
    }
    const items = data.items || [];

    const googleCount = items.filter(x=>x.kind==="google").length;
    const guestCount = items.filter(x=>x.kind==="guest").length;
    summary.innerHTML = `Toplam: <b>${items.length}</b> • Google: <b>${googleCount}</b> • Misafir: <b>${guestCount}</b>`;

    for(const it of items){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${pill(it.kind)}</td>
        <td>
          <div><b>${esc(it.email || it.id)}</b></div>
          <div class="muted">${esc(it.id)}</div>
        </td>
        <td><b>${esc(it.login_count)}</b></td>
        <td class="muted">${esc(it.last_login_at || "—")}</td>
        <td class="muted">${esc(JSON.stringify(it.meta || {}))}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  load();
</script>
</body>
</html>
