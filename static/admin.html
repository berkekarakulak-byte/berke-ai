<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#020617">
<title>Berke AI â€” Admin</title>

<style>
:root{
  --txt:#e5e7eb;
  --mut:#94a3b8;
  --stroke: 1px solid rgba(148,163,184,.20);
  --shadow: 0 25px 80px rgba(0,0,0,.55);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--txt);
  font-family: Inter, system-ui, Arial;
  background: url("/static/bg.jpg") center/cover no-repeat fixed;
}
body::before{
  content:"";
  position:fixed; inset:0;
  background: rgba(2,6,23,.62);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  z-index:-1;
}
.container{
  max-width:1100px;
  margin:24px auto;
  padding:18px;
}
.card{
  border-radius:22px;
  border: var(--stroke);
  box-shadow: var(--shadow);
  background: rgba(2,6,23,.45);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  overflow:hidden;
}
.header{
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom: 1px solid rgba(148,163,184,.18);
}
h1{margin:0;font-size:18px;font-weight:900;letter-spacing:.4px}
.badges{display:flex;gap:10px;flex-wrap:wrap}
.badge{
  font-size:12px;
  color:var(--mut);
  border: 1px solid rgba(148,163,184,.20);
  padding:8px 12px;
  border-radius:999px;
  background: rgba(2,6,23,.25);
}
.table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:12px 14px;
  border-bottom: 1px solid rgba(148,163,184,.14);
  font-size:13px;
}
th{ color:var(--mut); font-weight:700; }
tr:hover{ background: rgba(2,6,23,.22); }
.count{ font-weight:900; color:#60a5fa; }
.footer{
  padding:12px 16px;
  color:var(--mut);
  font-size:12px;
}
.center{
  text-align:center;
  margin-top:80px;
  font-size:18px;
}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <div class="header">
      <h1>ðŸ“Š Admin Panel</h1>
      <div class="badges">
        <div class="badge" id="guestB">ðŸ‘» Misafir: -</div>
        <div class="badge" id="googleB">ðŸ‘¤ Google: -</div>
        <div class="badge" id="buildB">ðŸ”¥ Build: -</div>
      </div>
    </div>

    <table class="table">
      <thead>
        <tr>
          <th>Mail</th>
          <th>GiriÅŸ</th>
          <th>Ä°lk</th>
          <th>Son</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>

    <div class="footer">Sadece yetkili admin gÃ¶rebilir.</div>
  </div>
</div>

<script>
const p = new URLSearchParams(location.search);
const email = p.get("email") || "";

async function load(){
  try{
    const h = await fetch("/health");
    const hj = await h.json();
    buildB.textContent = "ðŸ”¥ Build: " + (hj.build || "-");

    const r = await fetch(`/admin/data?email=${encodeURIComponent(email)}`);
    if(!r.ok) throw new Error("Yetkisiz");

    const data = await r.json();
    guestB.textContent = "ðŸ‘» Misafir: " + (data.guest_count ?? 0);

    const users = data.google_users || {};
    const keys = Object.keys(users);
    googleB.textContent = "ðŸ‘¤ Google: " + keys.length;

    rows.innerHTML = "";
    keys.sort().forEach(mail=>{
      const u = users[mail] || {};
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${mail}</td>
        <td class="count">${u.count ?? 0}</td>
        <td>${u.first_login ?? "-"}</td>
        <td>${u.last_login ?? "-"}</td>
      `;
      rows.appendChild(tr);
    });
  }catch(e){
    document.body.innerHTML = "<div class='center'>â›” Yetkisiz EriÅŸim</div>";
  }
}
load();
</script>

</body>
</html>
